%% lecture-glossary.sty
%%
%% --------------------------------------------------------------------------
%%
%% Autor: Florian Sihler, 22.09.2020
%%
%% Basically a styling for the glossary setting i like,
%% maybe more styles will be added in the future

\ProvidesPackage{lecture-glossary}[2020/09/22 v1.0 Glossary Styling]

% enumitem support
\newif\iflglos@setup@enumitem@
\DeclareOption{enumitem}{\lglos@setup@enumitem@true}
\DeclareOption{noenumitem}{\lglos@setup@enumitem@false}

\ProcessOptions*%

\RequirePackage[acronym,nopostdot,numberedsection=nameref,section,translate=babel]{glossaries-accsupp}% style=super
\RequirePackage{glossary-longragged}

\iflglos@setup@enumitem@
\RequirePackage{enumitem}
\fi

\newif\ifatinitglossary
% single- and plural-page
% this is a hack. i check if 'delimN' or 'delimR' are in the page def
% therefore i execute the page-commands but gobble all of their outputs
\newsavebox{\@lglos@la@void}
\def\@lglos@hide@in@da@void#1{\sbox{\@lglos@la@void}{#1}}
\def\lglos@spage{Seite}\def\lglos@ppage{Seiten}

\newif\iflglos@thispage@issingle@

\let\lglos@legacy@delimN\delimN \let\lglos@legacy@delimR\delimR
\def\lglos@delimN{\global\lglos@thispage@issingle@false\lglos@legacy@delimN} \def\lglos@delimR{\global\lglos@thispage@issingle@false\lglos@legacy@delimN}

\def\@lglos@printpages#1{%
    \quad\textit{\iflglos@thispage@issingle@\lglos@spage\else\lglos@ppage\fi:~#1}%
}
\def\lglos@printpages#1{%
    \let\delimN\lglos@delimN\let\delimR\lglos@delimR
    % think it is single (like me; :cry:)
    \lglos@thispage@issingle@true\@lglos@hide@in@da@void{#1}%
    \@lglos@printpages{#1}}

\def\LithieSetGlossaryStyle#1{\gdef\lglos@headingstyle##1{#1{##1}}}

\def\lglos@default@headingstyle#1{\begin{center}\strut\emph{#1}\end{center}}
\LithieSetGlossaryStyle{\lglos@default@headingstyle}

\def\LithieSetGlossaryOpts#1{\gdef\lglos@desc@options{#1}}
\LithieSetGlossaryOpts{}

\newglossarystyle{lecture@glossary}{%
    \setglossarystyle{tree}%
    \renewcommand{\glsgroupheading}[1]{\ifatinitglossary\else\def\lglos@enddesc{\end{description}}\expandafter\lglos@enddesc\fi\global\atinitglossaryfalse%
        \lglos@headingstyle{\glsgetgrouptitle{##1}}%
        \iflglos@setup@enumitem@%
        \protected@edef\lglos@curdesc{\noexpand\begin{description}[\lglos@desc@options]}\expandafter\lglos@curdesc%
        \else% no enumitem
        \begin{description}\fi}%
    \renewenvironment{theglossary}{%
        \parindent=\z@ \parskip=\z@ plus 0.3pt%
        \global\atinitglossarytrue\relax
        }{\end{description}}%#
    \renewcommand{\glossentry}[2]{%reset of tree to pad pagenumbers
        \hangindent\z@\relax \parindent\z@\relax
        \item[\glsentryitem{##1}\glstreenamefmt{\glstarget{##1}{\glossentryname{##1}}}]%
        \ifglshassymbol{##1}{\space(\glossentrysymbol{##1})}{}%
        \glstreepredesc\glossentrydesc{##1}\glspostdescription{}\lglos@printpages{##2}\par%
    }%
}
\setglossarystyle{lecture@glossary}
\makeglossaries

\preto\printglossaries{\bgroup\interlinepenalty=1000}
\g@addto@macro\printglossaries{\egroup}
\endinput