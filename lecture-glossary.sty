%% lecture-glossary.sty
%%
%% --------------------------------------------------------------------------
%%
%% Autor: Florian Sihler, 22.09.2020
%%
%% Basically a styling for the glossary setting i like,
%% maybe more styles will be added in the future

\ProvidesPackage{lecture-glossary}[2020/09/22 v1.0 Glossary Styling]

\RequirePackage[acronym,nopostdot,numberedsection,section]{glossaries-accsupp}% style=super, nonumberlist
\RequirePackage{glossary-longragged,xstring}

\newif\ifatinitglossary
% single- and plural-page
% this is a hack. i check if 'delimN' or 'delimR' are in the page def
% therefore i execute the page-commands but gobble all of their outputs
\newsavebox{\@lglos@la@void}
\def\@lglos@hide@in@da@void#1{%
    \expandafter\expandafter\expandafter\expandafter\expandafter\expandafter\expandafter\expandafter\expandafter%
    \expandafter\expandafter\expandafter\expandafter\expandafter\expandafter\expandafter\expandafter\expandafter%
    \expandafter\expandafter\expandafter\expandafter\expandafter\expandafter\expandafter\expandafter\expandafter%
    \expandafter\expandafter\expandafter\expandafter\expandafter\expandafter\expandafter\expandafter\expandafter%
    \expandafter\expandafter\expandafter\expandafter\expandafter\expandafter\expandafter\expandafter\expandafter%
    \expandafter\expandafter\expandafter\expandafter\expandafter\expandafter\expandafter\expandafter\expandafter%
    \expandafter\expandafter\expandafter\expandafter\expandafter\expandafter\expandafter\expandafter\expandafter%
    \expandafter\expandafter\expandafter\expandafter\expandafter\expandafter\expandafter\expandafter\expandafter%
    \expandafter\expandafter\expandafter\expandafter\expandafter\expandafter\expandafter\expandafter\expandafter%
    \expandafter\expandafter\expandafter\expandafter\expandafter\expandafter\expandafter\expandafter\expandafter%
    \@lglos@gobble#1%
    \expandafter\expandafter\expandafter\expandafter\expandafter\expandafter\expandafter\expandafter\expandafter%
    \expandafter\expandafter\expandafter\expandafter\expandafter\expandafter\expandafter\expandafter\expandafter%
    \expandafter\expandafter\expandafter\expandafter\expandafter\expandafter\expandafter\expandafter\expandafter%
    \expandafter\expandafter\expandafter\expandafter\expandafter\expandafter\expandafter\expandafter\expandafter%
    \expandafter\expandafter\expandafter\expandafter\expandafter\expandafter\expandafter\expandafter\expandafter%
    \expandafter\expandafter\expandafter\expandafter\expandafter\expandafter\expandafter\expandafter\expandafter%
    \expandafter\expandafter\expandafter\expandafter\expandafter\expandafter\expandafter\expandafter\expandafter%
    \expandafter\expandafter\expandafter\expandafter\expandafter\expandafter\expandafter\expandafter\expandafter%
    \expandafter\expandafter\expandafter\expandafter\expandafter\expandafter\expandafter\expandafter\expandafter%
    \expandafter\expandafter\expandafter\expandafter\expandafter\expandafter\expandafter\expandafter\expandafter%
    \expandafter\expandafter\expandafter\expandafter\expandafter\expandafter\expandafter\expandafter\expandafter\@nil%
}
\def\lglos@spage{Seite}\def\lglos@ppage{Seiten}

\newif\iflglos@thispage@issingle@

% TODO: protect against re-definition
\def\delimN{\lglos@thispage@issingle@false, } \def\delimR{ \lglos@thispage@issingle@false-- }

\def\@lglos@printpages#1{%
% think it is single (like me; :cry:)
\quad\textit{\iflglos@thispage@issingle@\lglos@spage\else\lglos@ppage\fi: #1}%
}
\def\lglos@printpages#1{%
\lglos@thispage@issingle@true\@lglos@hide@in@da@void{#1}%
\@lglos@printpages{#1}%
}
\newglossarystyle{lecture@glossary}{%
    \setglossarystyle{tree}%

    \renewcommand{\glsgroupheading}[1]{\ifatinitglossary\else\end{description}\fi\global\atinitglossaryfalse\begin{center}\strut\emph{\glsgetgrouptitle{##1}}\end{center}
        \begin{description}}%

    \renewenvironment{theglossary}{\setlength{\parindent}{0pt}%
        \setlength{\parskip}{0pt plus 0.3pt}%
        \global\atinitglossarytrue\relax
        }{\end{description}}%#

    \renewcommand{\glossentry}[2]{%reset of tree to pad pagenumbers
        \hangindent0pt\relax \parindent0pt\relax
        \item[\glsentryitem{##1}\glstreenamefmt{\glstarget{##1}{\glossentryname{##1}}}]%
        \ifglshassymbol{##1}{\space(\glossentrysymbol{##1})}{}%
        \glstreepredesc\glossentrydesc{##1}\glspostdescription{}\lglos@printpages{##2}\par
    }%
}
\setglossarystyle{lecture@glossary}
\makeglossaries
% TODO: glossary link style; translate pages and remove n if only one
% TODO: generate latexmkrc?
\endinput