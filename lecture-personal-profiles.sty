%% lecture-personal-profiles.sty
%%
%% --------------------------------------------------------------------------
%%
%% Autor: Florian Sihler, 3.11.2020
%%
%% Profiles i use in my scripts

\ProvidesPackage{lecture-personal-profiles}[2020/11/03 v1.0 Personal profiles]

\RequirePackage{kvoptions}
\SetupKeyvalOptions{family=LPP,prefix=LPP@}

\DeclareStringOption{imgprefix}
\DeclareStringOption{command}
\ProcessKeyvalOptions*\relax%

\RequirePackage{lettrine}
\setcounter{DefaultLines}{3}%
\LettrineOnGridfalse
\LettrineRealHeighttrue
\DefaultSlope=\z@
\def\LettrineTextFont{}%

% #1 name #2 prefix #3 print #4 default scale #5 ex args
\def\lecture@profiles@MakeImageCommands#1#2#3#4#5{%
\expandafter\newcommand\expandafter*\csname Get#1\endcsname[2][#4]{\centering\includegraphics[width=##1\linewidth,#5]{#2##2-#3compressed}}% -compressed
\expandafter\newcommand\expandafter*\csname Get#1Raw\endcsname[2][]{\includegraphics[##1]{#2##2-#3compressed}}%
}

\newif\ifscol%
\AppendToProfile{print}{%
  \edef\@mkcommands{\noexpand\lecture@profiles@MakeImageCommands{\LPP@command}{\LPP@imgprefix}{print-}{1}{}}\@mkcommands%
  \DisableMulticolHint%
  \scolfalse%
  \newenvironment{ltabular}%
      {\@nameuse{tabular}}%
      {\@nameuse{endtabular}}%
  \RequirePackage{Romantik}% Romantik for cfr initials?
  \DefaultFindent=5.15pt%
  \DefaultNindent=0.489pt% compensate for offsets
  \def\LettrineFontHook{\Romantik}%
  \AtBeginDocument{%
    \hypersetup{pdftitle={\lecture@r{title} (Druckversion)}}%
  }%
  \def\LettrineTextFont{\scshape}%
}

\AppendToProfile{default}{%
  \edef\@mkcommands{\noexpand\lecture@profiles@MakeImageCommands{\LPP@command}{\LPP@imgprefix}{}{1}{}}\@mkcommands%
  \DisableMulticolHint%
  \scolfalse%
  \newenvironment{ltabular}%
      {\@nameuse{tabular}}%
      {\@nameuse{endtabular}}%
  % we color it
  \def\LettrineFontHook{\color{paletteA}}%
  \DefaultFindent=1.85pt%
  \DefaultNindent=0.25em%
  \def\DefaultLoversize{0.05}%
  \AtBeginDocument{%
    \hypersetup{pdftitle={\lecture@r{title} (Digitale-Version)}}%
  }%
}

\RegisterProfile{mobile}{%
  \edef\@mkcommands{\noexpand\lecture@profiles@MakeImageCommands{\LPP@command}{\LPP@imgprefix}{}{0.925}{height=0.8\noexpand\textheight,keepaspectratio}}\@mkcommands%
  \DisableMulticolHint%\EnableMulticolHint%
  \scoltrue\makeatletter%
  \def\fps@figure{tbp}\def\fps@table{tbp}%
  \def\floatpagefraction{0.5}\def\topfraction{0.7}%
  \def\bottomfraction{0}\setcounter{topnumber}{3}%2
  \setcounter{bottomnumber}{0}\setcounter{totalnumber}{3}%
  \newenvironment{ltabular}%
    {\bgroup\small\@nameuse{xtabular}}%
    {\@nameuse{endxtabular}\egroup}%
  \setcounter{DefaultLines}{2}%
  % we color it
  \def\LettrineFontHook{\color{paletteA}}%
  \DefaultFindent=1.85pt%
  \DefaultNindent=0.25em%
  \AtBeginDocument{%
    \hypersetup{pdftitle={\lecture@r{title} (Mobilversion)}}%
  }%
}

\endinput