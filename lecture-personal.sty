%% lecture-personal.sty
%%
%% --------------------------------------------------------------------------
%%
%% Autor: Florian Sihler, 3.11.2020
%%
%% Float modifications i use in my scripts

\ProvidesPackage{lecture-personal}[2020/11/03 v1.0 Personal collection]

\RequirePackage{kvoptions}
\SetupKeyvalOptions{family=LPM,prefix=LPM@}

\DeclareStringOption{imgprefix}
\DeclareStringOption{command}

\ProcessKeyvalOptions*\relax%

\RequirePackage{lecture-personal-float,lecture-personal-general,lecture-personal-tikz,lecture-personal-glossary,lecture-personal-tabular,lecture-personal-resize}
\RequirePackage[imgprefix=\LPM@imgprefix,command=\LPM@command]{lecture-personal-profiles}

% if supertabular is loaded, they would conflict :)))
\let\tablehead\undefined \let\tablefirsthead\undefined
\let\tabletail\undefined \let\tablelasttail\undefined
\let\sttraceon\undefined \let\sttraceoff\undefined
\let\ST@trace\undefined  \let\shrinkheight\undefined
\let\setSTheight\undefined
\PassOptionsToPackage{chapterlistsgap=\medskipamount}{newfloat}
\RequirePackage{newfloat,subcaption,xtab}
\addto\captionsngerman{\renewcommand{\equationautorefname}{Formel}}
\addto\captionsenglish{\renewcommand{\equationautorefname}{Equation}}

\DeclareFloatingEnvironment[%
    fileext=loc,listname={Alle Listings},name=Listing,%
    placement=tbp,within=none,%
]{code}

% patch to bridge for lithie boxe
\def\listofcodes{\bgroup%
\def\contentsname{Alle Listings}% may?
\libx@listof@heading{\contentsname}%
\let\numberline\libx@list@numberformat% right align by boxes
\libx@starttoc{loc}%
\egroup}
% modifx code styles to match box

\newlength\cftcodenumwidth
\setlength\cftcodenumwidth{\libx@numwidth+\libx@numwidth@offset}

\gdef\l@code#1#2{\@dottedtocline{1}{\cftcodenumwidth}{\cftcodenumwidth}{#1}{#2}}%

\AppendToProfile{print}{%
    \AtBeginEnvironment{code}{\lstfs{10}}%
    \AtBeginEnvironment{code*}{\lstfs{10}}%
    \lstset{lineskip=3pt}%
}

\AppendToProfile{mobile}{%
    \AtBeginEnvironment{code}{\lstfs{11}}%
    \AtBeginEnvironment{code*}{\lstfs{11}}%
    \colorlet{sol@colors@border}{sol@colors@background}
    %\colorlet{sol@colors@background}{white!0}%
    \lstset{lineskip=3.25pt}%
}

\endinput