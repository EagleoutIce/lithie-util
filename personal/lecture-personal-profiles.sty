% lecture-personal-profiles.sty
% Author: Florian Sihler, 3.11.2020
% Profiles i use in my scripts
\ProvidesPackage{lecture-personal-profiles}[2020/11/03 v1.0 Personal profiles]
\RequirePackage{kvoptions}
\SetupKeyvalOptions{family=LPP,prefix=LPP@}
\DeclareStringOption{imgprefix}
\DeclareStringOption{command}
\ProcessKeyvalOptions*
\RequirePackage{lettrine}
\setcounter{DefaultLines}{3}
\LettrineOnGridfalse\LettrineRealHeighttrue
\DefaultSlope\z@
\def\LettrineTextFont{}
\def\lecture@fig@compressed@suffix{-compressed}
% #1 name #2 prefix #3 print #4 default scale #5 ex args
\def\lecture@profiles@MakeImageCommands#1#2#3#4#5{%
\expandafter\newcommand\expandafter*\csname Get#1\endcsname[2][#4]{\centering\includegraphics[width=##1\linewidth,#5]{#2##2#3\lecture@fig@compressed@suffix}}%
\expandafter\newcommand\expandafter*\csname Get#1Raw\endcsname[2][]{\includegraphics[##1]{#2##2#3\lecture@fig@compressed@suffix}}%
\expandafter\newcommand\expandafter*\csname GetUncompressed#1\endcsname[2][#4]{\centering\includegraphics[width=##1\linewidth,#5]{#2##2#3}}%
\expandafter\newcommand\expandafter*\csname GetUncompressed#1Raw\endcsname[2][]{\includegraphics[##1]{#2##2#3}}%
}

\def\lecture@personal@printsuffix{ (Druckversion)}
\newif\ifscol
\AppendToProfile{print}{%
  \edef\@mkcommands{\noexpand\lecture@profiles@MakeImageCommands{\LPP@command}{\LPP@imgprefix}{-print}{1}{}}\@mkcommands\DisableMulticolHint\scolfalse
  \newenvironment{ltabular}%
    {\csname tabular\endcsname}%
    {\csname endtabular\endcsname}%
  \RequirePackage{Romantik}% Romantik for cfr initials?
  \DefaultFindent=5.15pt%
  \DefaultNindent=.489pt% compensate for offsets
  \def\LettrineFontHook{\Romantik}%
  \AtBeginDocument{%
    \hypersetup{pdftitle={\lecture@r{title}\lecture@personal@printsuffix}}%
  }%
  \colorlet{libx@limerence@box@backcolor}{gray!5!white}%
  \def\LettrineTextFont{\scshape}%
}

\def\lecture@personal@defaultsuffix{ (Digitalversion)}
\AppendToProfile{default}{%
  \edef\@mkcommands{\noexpand\lecture@profiles@MakeImageCommands{\LPP@command}{\LPP@imgprefix}{}{1}{}}\@mkcommands
  \DisableMulticolHint
  \scolfalse
  \newenvironment{ltabular}%
    {\csname tabular\endcsname}%
    {\csname endtabular\endcsname}%
  % we color it
  \def\LettrineFontHook{\color{paletteA}}%
  \DefaultFindent=1.85pt%
  \DefaultNindent=.25em%
  \def\DefaultLoversize{.05}%
  \AtBeginDocument{%
    \hypersetup{pdftitle={\lecture@r{title}\lecture@personal@defaultsuffix}}%
  }%
}

\def\lecture@personal@mobilsuffix{ (Mobilversion)}
\RegisterProfile{mobile}{%
  \edef\@mkcommands{\noexpand\lecture@profiles@MakeImageCommands{\LPP@command}{\LPP@imgprefix}{}{.925}{height=.8\noexpand\textheight,keepaspectratio}}\@mkcommands
  \DisableMulticolHint
  \scoltrue\makeatletter
  \def\fps@figure{tbp}\def\fps@table{tbp}%
  \def\floatpagefraction{.5}\def\topfraction{.7}%
  \def\bottomfraction{0}\setcounter{topnumber}{3}%2
  \setcounter{bottomnumber}{0}\setcounter{totalnumber}{3}%
  \newenvironment{ltabular}%
    {\begingroup\small\csname xtabular\endcsname}%
    {\csname endxtabular\endcsname\endgroup}%
  \setcounter{DefaultLines}{2}%
  % we color it
  \def\LettrineFontHook{\color{paletteA}}%
  \DefaultFindent=1.85pt%
  \DefaultNindent=.25em%
  \AtBeginDocument{%
    \hypersetup{pdftitle={\lecture@r{title}\lecture@personal@mobilsuffix}}%
  }%
}
\endinput